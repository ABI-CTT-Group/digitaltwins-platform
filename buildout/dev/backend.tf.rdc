terraform {
  backend "s3" {
    bucket  = "terraform-states"             # Your object store bucket/container
    key     = "digitaltwins/dev/terraform.tfstate"    # Path within the bucket for the state file
    endpoints = {
      s3  = "https://object.akl-1.cloud.nesi.org.nz"
      sts  = "https://object.akl-1.cloud.nesi.org.nz"
      iam  = "https://object.akl-1.cloud.nesi.org.nz"
    } # Your object store API endpoint
    region  = "akl-1"                     # Region or compatible region string

    # Optional settings for some backends:
    use_path_style = true    # needed for many S3-compatible stores
    skip_requesting_account_id = true
    skip_metadata_api_check = true
    skip_s3_checksum = true

    # Optional if you do not want Terraform to validate credentials or region:
    skip_credentials_validation = true
    skip_region_validation = true

    # S3 Access credentials (avoid hard-coding; better to use env vars)
    # Set and export these in the calling environment:
    #    export AWS_ACCESS_KEY_ID=$(gsecret get terraform_states_s3_key)
    #    export AWS_SECRET_ACCESS_KEY=$(gsecret get terraform_states_s3_secret)
    #access_key = "xxxxxx"
    #secret_key = "xxxxxx"
  }
}
